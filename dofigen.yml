builders:
- name: build
  image: elixir:1.13-alpine
  workdir: /app
  script:
  - apk add --no-cache build-base git python3 openssh
  - mix local.hex --force
  - mix local.rebar --force
  - mix do deps.get
  - mix do deps.compile --force
  - mix phx.digest
  - mix compile
  - mix release lenra
  envs:
    MIX_ENV: prod
  adds:
  - .
  caches:
  - /app/_build
image: erlang:24-alpine
workdir: /app
artifacts:
- builder: build
  source: "/app/_build/prod/rel/lenra"
  destination: "."
root:
  script:
  - adduser -D lenra
user: lenra
entrypoint:
- /entrypoint.sh
cmd:
- start
